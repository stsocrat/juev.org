<!DOCTYPE html>
<!--
    You can email me with PGP-key: 0xE8ADA1A55B3CA4EA
-->
<html lang="ru">
<head>
  <link rel="dns-prefetch" href="https://static.juev.org">
  <meta charset="utf-8">
  <title>lighttpd - истребитель в мире веб-серверов</title>
  <meta name="description" content="При использовании VPS-сервера с мощным ограничением памяти у меня встал вопрос – какой веб-сервер использовать? Apache отпал сразу, так как потребляет очень много памяти даже на один ресурс.  Попро...">
  <meta name="yandex-verification" content="59bb4b98872e096b" />
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- end -->
  <link rel="canonical" href="https://www.juev.org/2009/07/18/lighttpd-istrebitel-v-mire-veb-serverov/">
  <link rel="shortcut icon" href="https://static.juev.org/favicon.ico">
  <link rel="apple-touch-icon" href="https://www.juev.org/apple-touch-icon.png">
  <link rel="alternate" type="application/atom+xml" title="ATOM Feed" href="https://www.juev.org/atom.xml">
  <link rel="stylesheet" type="text/css" href="https://static.juev.org/assets/css/master.6bbfa8b61.css">
  <link rel="prev" href="https://www.juev.org/2009/07/16/gnupg/">
  <link rel="next" href="https://www.juev.org/2009/07/21/pervoe-prilozhenie-v-rails/">
  <!-- og:meta -->
  <meta content="lighttpd - истребитель в мире веб-серверов" property="og:title">
  <meta content="При использовании VPS-сервера с мощным ограничением памяти у меня встал вопрос – какой веб-сервер использовать? Apache отпал сразу, так как потребляет очень много памяти даже на один ресурс.  Попро..." property="og:description">
  <meta content="https://www.juev.org/2009/07/18/lighttpd-istrebitel-v-mire-veb-serverov/" property="og:url">
  <meta content="2009-07-18T00:00:00+04:00" property="article:published_time">
  <meta content="lighttpd" property="article:tag">
  <meta content="apache" property="article:tag">
  <meta content="vps" property="article:tag">
  <meta content="https://static.juev.org/images/calvin.png" property="og:image">
  <meta content="https://denis.evsyukov.org" property="article:author">
  <!-- end og:meta  -->
  <!-- twitter card -->
  <meta content="summary_large_image" name="twitter:card">
  <meta content="lighttpd - истребитель в мире веб-серверов" name="twitter:title">
  <meta content="При использовании VPS-сервера с мощным ограничением памяти у меня встал вопрос – какой веб-сервер использовать? Apache отпал сразу, так как потребляет очень много памяти даже на один ресурс.  Попро..." property="twitter:description">
  <meta content="https://www.juev.org/2009/07/18/lighttpd-istrebitel-v-mire-veb-serverov/" name="twitter:url">
  <meta content="https://static.juev.org/images/calvin.png" property="twitter:image:src">
  <!-- end twitter card -->
</head>
<body class="wide">
  <div class="navigation">
    <div class="width-fix">
        <a href="https://www.juev.org/" id="home" rel="nofollow"></a>
      <ul>
        <li><a href="https://www.juev.org/articles.html" rel="nofollow">Статьи</a></li>
        <li>|</li>
        <li><a href="https://denis.evsyukov.org">Об авторе</a></li>
      </ul>
    </div>
  </div>
  <div class="primary-content width-fix">
    <div class="entry"><h1 class="title">lighttpd - истребитель в мире веб-серверов</h1>
<div id="metainfo">
<span class="date">18 July 2009</span>
<span class="tags"><a href="https://www.juev.org/tags/#lighttpd" title="View posts tagged with &quot;lighttpd&quot;" rel="nofollow">#lighttpd</a><a href="https://www.juev.org/tags/#apache" title="View posts tagged with &quot;apache&quot;" rel="nofollow">#apache</a><a href="https://www.juev.org/tags/#vps" title="View posts tagged with &quot;vps&quot;" rel="nofollow">#vps</a></span>
</div>
<div class="post"><p>При использовании VPS-сервера с мощным ограничением памяти у меня встал вопрос – какой веб-сервер использовать? Apache отпал сразу, так как потребляет очень много памяти даже на один ресурс. Попробовал отечественную разработку nginx, намного лучше, но настройка оказалась не тривиальной, приходилось копаться в интернете, чтобы решить довольно простые задачи. И по памяти, хотя и много меньше nginx потреблял чем apache, но как оказалось, есть гораздо лучшее решение.</p>

<p>Если честно, я немного лукавлю, когда говорю, что начинал свои тесты с apache и затем переходил на nginx. Конечно же, это было не так. Еще до заказа VPS-сервера я знал, что буду использовать lighttpd, но нужно было протестировать и остальные сервисы. Что я собственно и сделал. Но уже после того, как досконально обкатал lighttpd…</p>

<p>При использовании в условиях жесткого ограничения памяти lighttpd показал себя только с наилучшей стороны. Он потреблял порядка 5-8 мегабайт памяти на все домены, которые были на него настроены. В отличие от nginx, процесс которого в памяти занимал более 30 мегабайт. Апач при тех же условиях сжирал всю доступную память. И в тоже время настройка lighttpd столь тривиальна, что на ней можно было бы и не останавливаться. Но хочу показать, насколько это просто.</p>

<p>Основная часть VPS-серверов использует Debian, поэтому я буду рассматривать именно эту операционную систему. Настройка в других операционных системах несколько отличается от представленной.</p>

<p>Если VPS-сервер был заказан с установленным апачем, его необходимо отключить и убрать из автозагрузки:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">~# /etc/init.d/apache2 stop
~# update-rc.d <span class="nt">-f</span> apache2 remove</code></pre></figure>

<p>Теперь можно приступать к установке легкого веб-сервера:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">~# apt-get install lighttpd</code></pre></figure>

<p>Начиная с этого момента на сервере уже будет работать lighttpd, осталось его настроить. Разберем возможность использования PHP и MySQL на веб-сервере. Для этого, если это не было сделано заранее, установим необходимые пакеты:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">~# apt-get install php5-cgi mysql-server mysql-client</code></pre></figure>

<p>При установке mysql-сервера будет запрошен пароль на доступ к серверу. Не забудьте его задать, иначе сервер баз данных будет открыт для доступа из интернета. Теперь нужно только включить модуль fastcgi в lighttpd:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">~# lighttpd-enable-mod
    Available modules: auth cgi fastcgi proxy rrdtool simple-vhost ssi ssl status userdir phpmyadmin
    Already enabled modules: auth fastcgi simple-vhost phpmyadmin
    Enable module:</code></pre></figure>

<p>Используется команда <em>lighttpd-enable-mod</em>, если запустить ее без параметров, как показано в примере, будут выведены имена всех доступных модулей и предложено включить нужные. Можно сократить немного времени, если сразу задавать команду с параметром в виде имени того модуля, что нужно активировать:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">~# lighttpd-enable-mod fastcgi</code></pre></figure>

<p>После выполнения этой команды нужно будет перезагрузить веб-сервер:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">~# /etc/init.d/lighttpd force-reload</code></pre></figure>

<p>Теперь наш веб-сервер может работать с PHP-скриптами. Проверим. Для этого в корне нашего сайта (по умолчанию все сайты располагаются в <em>/var/www/</em>) создаем файл <em>info.php</em> со следующим содержимым:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="nb">phpinfo</span><span class="p">();</span>
<span class="cp">?&gt;</span></code></pre></figure>

<p>И обращаемся к нашему веб-серверу с помощью браузера по адресу <code class="highlighter-rouge">www.examples.ru/info.php</code>, в данном случае подразумевается, что www.examples.ru имя сайта, если доменное имя еще не зарегистрировано, можно вместо него обращаться по ip-адресу. В ответ должны получить полную информацию о используемом PHP.</p>

<p>Для отключения модуля используется команда <em>lighttpd-disable-mod</em>.</p>

<p>После перезапуска веб-сервера в памяти будут висеть несколько процессов <em>php-cgi</em>, каждый из которых занимает порядка 30 мегабайт (после оптимизации использования стека оперативной памяти). Количество процессов напрямую зависит от значения переменной <em>max-procs</em>, заданной в файле <em>/etc/lighttpd/conf-available/10-fastcgi.conf</em>, минимальное значение равно единице (1), при этом будет использоваться 2 процесса <em>php-cgi</em>.</p>

<p>По умолчанию fastcgi настроено на обработку файлов <em>.php</em>. Если необходимо использовать perl, python или ruby, необходимо изменять файл <em>/etc/lighttpd/conf-available/10-fastcgi.conf.</em> Например, если необходимо отключить обработку php-файлов и включить python для использования django, приводим его к такому виду:</p>

<figure class="highlight"><pre><code class="language-conf" data-lang="conf"><span class="c">## FastCGI programs have the same functionality as CGI programs,
## but are considerably faster through lower interpreter startup
## time and socketed communication
##
## Documentation: /usr/share/doc/lighttpd-doc/fastcgi.txt.gz
##                http://www.lighttpd.net/documentation/fastcgi.html
</span>
<span class="n">server</span>.<span class="n">modules</span>   += ( <span class="s2">"mod_fastcgi"</span> )

<span class="n">fastcgi</span>.<span class="n">server</span>    = (
    <span class="s2">"/"</span> =&gt; (
        <span class="s2">"main"</span> =&gt; (
            <span class="c"># Use host / port instead of socket for TCP fastcgi
</span>            <span class="s2">"host"</span> =&gt; <span class="s2">"127.0.0.1"</span>,
            <span class="s2">"port"</span> =&gt; <span class="m">3033</span>,
            <span class="c">#"socket" =&gt; "/tmp/django.socket",
</span>            <span class="s2">"check-local"</span> =&gt; <span class="s2">"disable"</span>,
        ))
)

<span class="n">alias</span>.<span class="n">url</span> = (
    <span class="s2">"/media"</span> =&gt; <span class="s2">"/var/www/django/django/contrib/admin/media/"</span>,
)

<span class="n">url</span>.<span class="n">rewrite</span>-<span class="n">once</span> = (
    <span class="s2">"^(/media.*)$"</span> =&gt; <span class="s2">"$1"</span>,
    <span class="s2">"^/favicon\.ico$"</span> =&gt; <span class="s2">"/media/favicon.ico"</span>,
    <span class="s2">"^(/.*)$"</span> =&gt; <span class="s2">"/example$1"</span>,
)</code></pre></figure>

<p>Останавливаться на подробностях настройки различных движков я не буду. А перейду сразу к простому использованию виртуальных хостов. В том же apache для использования виртуальных хостов необходимо каждый раз менять конфигурацию сервера и перезапускать его. В lighttpd есть отдельный модуль, который необходимо активировать, настроить, после чего виртуальные хосты можно будет организовывать путем простого создания каталогов. Начинаем:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">~# vim /etc/lighttpd/conf-available/10-simple-vhost.conf</code></pre></figure>

<p>И проверяем значения переменных <em>simple-vhost.server-root</em> и <em>simple-vhost.document-root</em>:</p>

<figure class="highlight"><pre><code class="language-conf" data-lang="conf"><span class="c">## Simple name-based virtual hosting
##
## Documentation: /usr/share/doc/lighttpd-doc/simple-vhost.txt
##                http://www.lighttpd.net/documentation/simple-vhost.html
</span>
<span class="n">server</span>.<span class="n">modules</span> += ( <span class="s2">"mod_simple_vhost"</span> )

<span class="c">## The document root of a virtual host isdocument-root =
##   simple-vhost.server-root + $HTTP["host"] + simple-vhost.document-root
</span><span class="n">simple</span>-<span class="n">vhost</span>.<span class="n">server</span>-<span class="n">root</span>         = <span class="s2">"/var/www"</span>
<span class="n">simple</span>-<span class="n">vhost</span>.<span class="n">document</span>-<span class="n">root</span>       = <span class="s2">"/html/"</span>

<span class="c">## the default host if no host is sent
</span><span class="n">simple</span>-<span class="n">vhost</span>.<span class="n">default</span>-<span class="n">host</span>        = <span class="s2">"example.ru"</span></code></pre></figure>

<p>В данном случае все виртуальные хосты будут располагаться в каталоге /var/www и каждый виртуальный хост содержит в себе папку html, в которой располагаются сами файлы. Теперь активируем модуль виртуальных хостов:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">~# lighttpd-enable-mod simple-vhost</code></pre></figure>

<p>И после перезапуска веб-сервера, начинаем создавать виртуальные хосты:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">~# /etc/init.d/lighttpd restart
~# mkdir /var/www/test1.ru
~# mkdir /var/www/test1.ru/html
~# mkdir /var/www/test2.ru
~# mkdir /var/www/test2.ru/html</code></pre></figure>

<p>И начинаем заполнять содержимое наших двух, только что организованных сайтов <em>test1</em> и <em>test2</em>. Естественно, чтобы все работало, данные доменные имена должны быть зарегистрированы. Сразу после создания данных каталогов и создания нужных файлов в каталогах html сайты будут работать. Теперь не нужно для организации нового сайта перезагружать веб-сервер.</p>

<p>Как видите, веб-сервер является самым легким из всех существующих решений, которые есть на сегодняшний день. И в то же время его очень просто настраивать. Все тривиально и очень просто!</p>
</div>
<div class="meta"><div class="pagination">
 <p class="previous">Previous post: <a rel="prev" href="https://www.juev.org/2009/07/16/gnupg/" title="View GnuPG - безопасность электронной почты">GnuPG - безопасность электронной почты</a></p>
 <p class="next">Next post: <a rel="next" href="https://www.juev.org/2009/07/21/pervoe-prilozhenie-v-rails/" title="View Первое приложение в Rails">Первое приложение в Rails</a></p></div>
</div>
</div>
  </div><!-- noindex -->
  <div class="footer">
    <div class="width-fix">
      <p><a href="https://www.juev.org/articles.html" rel="nofollow">Список статей</a> :: <a href="https://www.juev.org/recommendations/" rel="nofollow">Рекомендации</a> :: <a href="https://www.juev.org/atom.xml" rel="nofollow">RSS</a></p>
      <p>&copy;&nbsp;<a href="https://denis.evsyukov.org">Denis Evsyukov</a>,&nbsp;2008&ndash;2019&nbsp;Contact me via <script type="text/javascript">document.write("<n uers=\"znvygb:qravf\100riflhxbi\056bet\">Rznvy</n>".replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<="Z"?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26);}));</script>,&nbsp;
      <a href="https://twitter.com/#!/Juev" rel="nofollow">twitter</a> or&nbsp;
      <a href="https://github.com/Juev" rel="nofollow">github</a></p>
    </div>
  </div>
  <script async src="https://static.juev.org/assets/js/master.a08e4d4f.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-26480484-5', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
