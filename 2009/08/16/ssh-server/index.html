<!DOCTYPE html>
<!--
    You can email me with PGP-key: 0xE8ADA1A55B3CA4EA
-->
<html lang="ru">
<head>
  <link rel="dns-prefetch" href="https://static.juev.org">
  <meta charset="utf-8">
  <title>SSH-сервер: вопросы безопасности</title>
  <meta name="description" content="Думаю, не стоит объяснять для чего обычно организуется SSH-сервер? Рассмотрим его установку и организацию безопасной работы с ним. Для установки и клиента и сервера SSH следует использовать пакет O...">
  <meta name="yandex-verification" content="59bb4b98872e096b" />
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- end -->
  <link rel="canonical" href="https://www.juev.org/2009/08/16/ssh-server/">
  <link rel="shortcut icon" href="https://static.juev.org/favicon.ico">
  <link rel="apple-touch-icon" href="https://www.juev.org/apple-touch-icon.png">
  <link rel="alternate" type="application/atom+xml" title="ATOM Feed" href="https://www.juev.org/atom.xml">
  <link rel="stylesheet" type="text/css" href="https://static.juev.org/assets/css/master.6bbfa8b61.css">
  <link rel="prev" href="https://www.juev.org/2009/08/15/ustanovka-stumpwm/">
  <link rel="next" href="https://www.juev.org/2009/08/17/emacs-daemon/">
  <!-- og:meta -->
  <meta content="SSH-сервер: вопросы безопасности" property="og:title">
  <meta content="Думаю, не стоит объяснять для чего обычно организуется SSH-сервер? Рассмотрим его установку и организацию безопасной работы с ним. Для установки и клиента и сервера SSH следует использовать пакет O..." property="og:description">
  <meta content="https://www.juev.org/2009/08/16/ssh-server/" property="og:url">
  <meta content="2009-08-16T00:00:00+04:00" property="article:published_time">
  <meta content="archlinux" property="article:tag">
  <meta content="ssh" property="article:tag">
  <meta content="security" property="article:tag">
  <meta content="https://static.juev.org/images/calvin.png" property="og:image">
  <meta content="https://denis.evsyukov.org" property="article:author">
  <!-- end og:meta  -->
  <!-- twitter card -->
  <meta content="summary_large_image" name="twitter:card">
  <meta content="SSH-сервер: вопросы безопасности" name="twitter:title">
  <meta content="Думаю, не стоит объяснять для чего обычно организуется SSH-сервер? Рассмотрим его установку и организацию безопасной работы с ним. Для установки и клиента и сервера SSH следует использовать пакет O..." property="twitter:description">
  <meta content="https://www.juev.org/2009/08/16/ssh-server/" name="twitter:url">
  <meta content="https://static.juev.org/images/calvin.png" property="twitter:image:src">
  <!-- end twitter card -->
</head>
<body class="wide">
  <div class="navigation">
    <div class="width-fix">
        <a href="https://www.juev.org/" id="home" rel="nofollow"></a>
      <ul>
        <li><a href="https://www.juev.org/articles.html" rel="nofollow">Статьи</a></li>
        <li>|</li>
        <li><a href="https://denis.evsyukov.org">Об авторе</a></li>
      </ul>
    </div>
  </div>
  <div class="primary-content width-fix">
    <div class="entry"><h1 class="title">SSH-сервер: вопросы безопасности</h1>
<div id="metainfo">
<span class="date">16 August 2009</span>
<span class="tags"><a href="https://www.juev.org/tags/#archlinux" title="View posts tagged with &quot;archlinux&quot;" rel="nofollow">#archlinux</a><a href="https://www.juev.org/tags/#ssh" title="View posts tagged with &quot;ssh&quot;" rel="nofollow">#ssh</a><a href="https://www.juev.org/tags/#security" title="View posts tagged with &quot;security&quot;" rel="nofollow">#security</a></span>
</div>
<div class="post"><p>Думаю, не стоит объяснять для чего обычно организуется SSH-сервер? Рассмотрим его установку и организацию безопасной работы с ним.</p>

<p>Для установки и клиента и сервера SSH следует использовать пакет OpenSSH. Хотя на сегодняшний день и существует целая масса различных программ для организации сервера и для работы в качестве клиента, именно OpenSSH позволяет организовать максимально безопасный и функциональный сервер.</p>

<p>Установить довольно просто, так как это популярный пакет, который присутствует в большинстве дистрибутивов, достаточно только воспользоваться пакетным менеджером:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ yaourt -S openssh
</code></pre></div></div>

<p>Настройки заданные по умолчанию вполне функциональны и безопасны. Теперь нам осталось немного настроить сам сервер, чтобы обеспечить максимальную его безопасность и запустить его…</p>

<p>Для настройки сервера изменяем файл <em>/etc/ssh/sshd_config</em></p>

<p>Во-первых, запрещаем вход на сервер пользователю root и запрещаем использовать пустые пароли. Для этого снимаем комментарии со строк:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PasswordAuthentication yes
PermitEmptyPasswords no
PermitRootLogin no
</code></pre></div></div>

<p>Тем самым запрещаем вход пользователю, имя которого заранее известно и работа в системе которого может привести к печальным последствиям. Если необходимо будет удаленно изменять настройки системы – существует sudo, предоставляющая необходимый функционал, защищенный паролем пользователя. В том случае его определяли методом перебора, и вдруг каким то образом он был определен, злоумышленник получит доступ к системе, но не сможет воспользоваться sudo. Если вдруг по каким то причинам у вашего пользователя не окажется пароля, то зайти удаленно в систему вы не сможете. Так как доступ пользователю root запрещен, злоумышленнику подбора пароля придется еще подбирать имя пользователя, а это уже далеко не тривиальная задача…</p>

<p>Для того, чтобы свести брутфорс к бесполезной трате времени, можно использовать пакет fail2ban. После небольшой настройки fail2ban отслеживает логи, и при наличии нескольких попыток соединения с одного и того же айпи-адреса, заносит его в список блокируемых. Другой способ – это добавление в iptables следующих правил:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ iptables -A INPUT -p tcp --syn --dport ssh -m recent --name ssh --set
$ iptables -A INPUT -p tcp --syn --dport ssh -m recent --name ssh --rcheck --seconds 30 --hitcount 2 -j DROP
</code></pre></div></div>

<p>Эти правила позволяют отбрасывать соединения с ip-адресов, с которых происходит более двух попыток соединения  за 30 секунд. Перебор вариантов становиться просто бессмысленным.</p>

<p>Но не будем останавливаться на достигнутом и пойдем дальше, зададим аутентификацию по закрытому ключу. При этом запретив аутентификацию по паролю:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PasswordAuthentication no
</code></pre></div></div>

<p>Но предварительно  необходимо создать ключи, если это еще не было сделано и передать их на сервер:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ssh-keygen -t rsa -b 2048 -f $HOME/.ssh/id_rsa
$ ssh-copy-id -i $HOME/.ssh/id_rsa.pub user@machine
</code></pre></div></div>

<p>При создании ключей будет произведен запрос пароля, который будет использоваться при обращении к закрытому ключу. Его следует обязательно задавать! Во избежание использования вашего закрытого ключа в случае его кражи.</p>

<p>При передаче ключа на сервер необходимо будет ввести пароль пользователя на сервере. Обращаю внимание на то, что передается именно публичный ключ! После чего запрещаем вход на сервер по паролю. Единственное неудобство данного способа заключается в том, что для аутентификации требуется наличие закрытого ключа.</p>

<p>Закрытый ключ с безпарольной аутентификацией самый надежный и безопасный способ. но он не всегда удобен. Вполне достаточно настроить сервер на запрет входа суперпользователю, запретить пустые пароли и ограничить количество соединений с одного ip-адреса.</p>

<p>После чего можно уже не опасаться взлома вашего ssh-сервера!</p>

<p>Теперь нам осталось только запустить сервер и настроить его запуск при старте компьютера. Для этого даем команду:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo /etc/rc.d/sshd start
</code></pre></div></div>

<p>И вносим изменения в файл <em>/etc/rc.conf</em>, добавив <em>sshd</em> в список <em>DAEMONS</em>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DAEMONS=(syslog-ng crond hal iptables network !netfs hddtemp sensors nscd alsa sshd mpd mpdscribble xinetd slim uptimed)
</code></pre></div></div>

<p>Собственно все! Приятной работы!</p>
</div>
<div class="meta"><div class="pagination">
 <p class="previous">Previous post: <a rel="prev" href="https://www.juev.org/2009/08/15/ustanovka-stumpwm/" title="View Установка stumpwm">Установка stumpwm</a></p>
 <p class="next">Next post: <a rel="next" href="https://www.juev.org/2009/08/17/emacs-daemon/" title="View emacs --daemon">emacs --daemon</a></p></div>
</div>
</div>
  </div><!-- noindex -->
  <div class="footer">
    <div class="width-fix">
      <p><a href="https://www.juev.org/articles.html" rel="nofollow">Список статей</a> :: <a href="https://www.juev.org/recommendations/" rel="nofollow">Рекомендации</a> :: <a href="https://www.juev.org/atom.xml" rel="nofollow">RSS</a></p>
      <p>&copy;&nbsp;<a href="https://denis.evsyukov.org">Denis Evsyukov</a>,&nbsp;2008&ndash;2019&nbsp;Contact me via <script type="text/javascript">document.write("<n uers=\"znvygb:qravf\100riflhxbi\056bet\">Rznvy</n>".replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<="Z"?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26);}));</script>,&nbsp;
      <a href="https://twitter.com/#!/Juev" rel="nofollow">twitter</a> or&nbsp;
      <a href="https://github.com/Juev" rel="nofollow">github</a></p>
    </div>
  </div>
  <script async src="https://static.juev.org/assets/js/master.a08e4d4f.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-26480484-5', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
