<!DOCTYPE html>
<!--
    You can email me with PGP-key: 0xE8ADA1A55B3CA4EA
-->
<html lang="ru">
<head>
  <link rel="dns-prefetch" href="https://static.juev.org">
  <meta charset="utf-8">
  <title>Commafeed на бесплатном сервере OpenShift</title>
  <meta name="description" content="После того, как отказался от использования платного Feedbin и перешел на Feedly, порой возникают мысли запустить свой собственный сервис.  Чем и занялся на выходных. Просмотрел целый ряд разработок...">
  <meta name="yandex-verification" content="59bb4b98872e096b" />
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- end -->
  <link rel="canonical" href="https://www.juev.org/2015/02/08/commafeed-openshift/">
  <link rel="shortcut icon" href="https://static.juev.org/favicon.ico">
  <link rel="apple-touch-icon" href="https://www.juev.org/apple-touch-icon.png">
  <link rel="alternate" type="application/atom+xml" title="ATOM Feed" href="https://www.juev.org/atom.xml">
  <link rel="stylesheet" type="text/css" href="https://static.juev.org/assets/css/master.6bbfa8b61.css">
  <link rel="prev" href="https://www.juev.org/2015/02/07/itunes-match/">
  <link rel="next" href="https://www.juev.org/2015/03/23/cypherpunks/">
  <!-- og:meta -->
  <meta content="Commafeed на бесплатном сервере OpenShift" property="og:title">
  <meta content="После того, как отказался от использования платного Feedbin и перешел на Feedly, порой возникают мысли запустить свой собственный сервис.  Чем и занялся на выходных. Просмотрел целый ряд разработок..." property="og:description">
  <meta content="https://www.juev.org/2015/02/08/commafeed-openshift/" property="og:url">
  <meta content="2015-02-08T11:55:28+03:00" property="article:published_time">
  <meta content="git" property="article:tag">
  <meta content="openshift" property="article:tag">
  <meta content="java" property="article:tag">
  <meta content="https://static.juev.org/2015/02/logo_2.png" property="og:image">
  <meta content="https://denis.evsyukov.org" property="article:author">
  <!-- end og:meta  -->
  <!-- twitter card -->
  <meta content="summary_large_image" name="twitter:card">
  <meta content="Commafeed на бесплатном сервере OpenShift" name="twitter:title">
  <meta content="После того, как отказался от использования платного Feedbin и перешел на Feedly, порой возникают мысли запустить свой собственный сервис.  Чем и занялся на выходных. Просмотрел целый ряд разработок..." property="twitter:description">
  <meta content="https://www.juev.org/2015/02/08/commafeed-openshift/" name="twitter:url">
  <meta content="https://static.juev.org/2015/02/logo_2.png" property="twitter:image:src">
  <!-- end twitter card -->
</head>
<body class="wide">
  <div class="navigation">
    <div class="width-fix">
        <a href="https://www.juev.org/" id="home" rel="nofollow"></a>
      <ul>
        <li><a href="https://www.juev.org/articles.html" rel="nofollow">Статьи</a></li>
        <li>|</li>
        <li><a href="https://denis.evsyukov.org">Об авторе</a></li>
      </ul>
    </div>
  </div>
  <div class="primary-content width-fix">
    <div class="entry"><h1 class="title">Commafeed на бесплатном сервере OpenShift</h1>
<div id="metainfo">
<span class="date">08 February 2015</span>
<span class="tags"><a href="https://www.juev.org/tags/#git" title="View posts tagged with &quot;git&quot;" rel="nofollow">#git</a><a href="https://www.juev.org/tags/#openshift" title="View posts tagged with &quot;openshift&quot;" rel="nofollow">#openshift</a><a href="https://www.juev.org/tags/#java" title="View posts tagged with &quot;java&quot;" rel="nofollow">#java</a></span>
</div>
<div class="post"><p>После того, как отказался от использования платного Feedbin и перешел на Feedly, порой возникают мысли запустить свой собственный сервис. Чем и занялся на выходных.</p>

<p>Просмотрел целый ряд разработок с исходным кодом, и решил остановится на <a href="https://github.com/Athou/commafeed">commafeed</a>, потому что выглядит интересно, работает шустро и написано на java, с которой уже работаю больше года.</p>

<p>Так же проект меня заинтересовал тем, что позволяет запустить сервер, используя всего несколько команд:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rhc create-app commafeed diy-0.1 mysql-5.5
cd commafeed
git remote add upstream -m master https://github.com/Athou/commafeed.git
git pull -s recursive -X theirs upstream master
git push
</code></pre></div></div>

<p>Что может быть проще? Предварительно устанавливаем клиент командной строки сервиса Openshift, и затем проводим регистрацию приложения, загружаем исходный код программы, и передаем на сервер, где уже автоматом проводится сборка проекта с последующим его запуском. И все это, заметьте, в бесплатном варианте! ;)</p>

<p>Но когда я попробовал передать на сервер код программы, получил ошибку:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Connection to diy-evsyukov.rhcloud.com closed by remote host.
fatal: The remote end hung up unexpectedly
error: error in sideband demultiplexer
To ssh://543463dbe0b8cdf4bd0005bb@diy-evsyukov.rhcloud.com/~/git/diy.git/
   b2a1c46..6c9ba28  master -&gt; master
error: failed to push some refs to 'ssh://543463dbe0b8cdf4bd0005bb@diy-evsyukov.rhcloud.com/~/git/diy.git/'
</code></pre></div></div>

<p>Нашел тикет <a href="https://github.com/Athou/commafeed/issues/637">New deploy on OpenShift Will not Finish</a>, в котором автор указал, что проблема заключается в недостаточной мощности сервера OpenShift для сборки проекта.</p>

<p>Решил попробовать последовать совету и провести сборку на локальном компьютере. Установил JDK 8.0, Maven 3.2.5 и в отдельной директории с кодом программы запустил сборку командой:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean package
</code></pre></div></div>

<p>Сборка проекта шла долго, и в результате получил заветный jar-файл в директории target. Теперь встал вопрос о том, каким образом передать его на сервер OpenShift и там запустить с указанием требуемого окружения.</p>

<p>Просмотрел документацию по OpenShift, как оказалось, в данном случае можно использовать только один вариант – это картридж Diy, который позволяет создавать свои собственные правила по деплою/запуску приложения. На этот раз через веб-интерфес создал новое приложение с Diy, подключил дополнительно базу данных Postgres. После чего готовый git-репозиторий выгрузил себе на локальную машину.</p>

<p>В данном случае репозиторий представляет собой две директории с файлом описания. Самая простейшая структура. Нам же предстоит добавить в нее директорию <code class="highlighter-rouge">.openshift</code> из репозитория <code class="highlighter-rouge">Athou/commafeed</code> и так же директорию target c результирующим файлом <code class="highlighter-rouge">commafeed.jar</code>.</p>

<p>Теперь остается только изменить скрипты в директории <code class="highlighter-rouge">.openshift/action_hooks</code>. В скрипте <code class="highlighter-rouge">build</code> комментируем последнюю строку, удаляя тем самым процес сборки:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># mvn clean package -DskipTests -Dos.arch=x64 -s .openshift/settings.xml
</code></pre></div></div>

<p>В скрипт <code class="highlighter-rouge">start</code> добавляем строки с указанием JAVA-окружения:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nb">cd</span> <span class="nv">$OPENSHIFT_REPO_DIR</span>
<span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span><span class="nv">$OPENSHIFT_DATA_DIR</span>/jdk1.8.0_20
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$JAVA_HOME</span>/bin:<span class="nv">$M2</span>:<span class="nv">$PATH</span>
nohup java <span class="nt">-jar</span> target/commafeed.jar server .openshift/config.mysql.yml <span class="o">&gt;</span> <span class="k">${</span><span class="nv">OPENSHIFT_DIY_LOG_DIR</span><span class="k">}</span>/commafeed.log 2&gt;&amp;2 &amp;
</code></pre></div></div>

<p>Без указания данных переменных запуск будет осуществлятся с системной версией Java, что приводит к ошибке и не работоспособности сервера.</p>

<p>И теперь остается изменить файл <code class="highlighter-rouge">.openshift/config.mysql.yml</code>, указав в нем основные настройки приложения и параметры соединения с базой данных. На настройках останавливаться не буду, они хорошо прокомментированы и понятны из контекста. Главное указать параметры соединения с базой данных:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>database:
  driverClass: org.postgresql.Driver
  url: jdbc:postgresql://127.7.230.130:5432/diy
  user: adwerelhwerj
  password: raB1mIj2Nun1
  properties:
	charSet: UTF-8
</code></pre></div></div>

<p>Необходимо указать используемый драйвер (как указывал ранее, я создавал приложение с Postgres), url, в котором указывается ip-адрес сервера с БД и имя базы данных, после чего указываем учетные данные для подключения. Все эти данные будут представлены после создания приложения в OpenShift.</p>

<p>Теперь добавляем файлы в репозиторий и передаем на сервер:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add .
git commit -a -m "Adding files"
git push
</code></pre></div></div>

<p>Запустить сервер корректно мне удалось с третьего или четвертого раза. При этом настройки доводиил до ума уже непосредственно на сервере, заходя на него по ssh:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rhc ssh diy
</code></pre></div></div>

<p>OpenShift бесплатно предоставляет 3 сервера размером small. Для небольших приложений оптимально. Commafeed запустился и работал довольно шустро.</p>

<p><a href="https://static.juev.org/2015/02/commafeed.png"><img src="https://static.juev.org/2015/02/commafeed.png" alt="" /></a></p>

<p>Приятным дополнением является возможность изменения стилей оформления без вмешательства в исходный код темы:</p>

<p><a href="https://static.juev.org/2015/02/settings.png"><img src="https://static.juev.org/2015/02/settings.png" alt="" /></a></p>

<p>Но что-то у меня пока не заладилось с русским языком в статьях:</p>

<p><a href="https://static.juev.org/2015/02/russian.png"><img src="https://static.juev.org/2015/02/russian.png" alt="" /></a></p>

<p>При этом проблема с русским языком наблюдается во всех лентах новостей без исключения.</p>

<p>CommaFeed оказался приятным RSS-ридером, с быстрым откликом и гибкими настройками. Буду ли я его использовать? Время покажет, пока предстоит разобраться с русским языком.</p>
</div>
<div class="meta"><div class="pagination">
 <p class="previous">Previous post: <a rel="prev" href="https://www.juev.org/2015/02/07/itunes-match/" title="View Разочарование: iTunes Match">Разочарование: iTunes Match</a></p>
 <p class="next">Next post: <a rel="next" href="https://www.juev.org/2015/03/23/cypherpunks/" title="View Свобода Интернета">Свобода Интернета</a></p></div>
</div>
</div>
  </div><!-- noindex -->
  <div class="footer">
    <div class="width-fix">
      <p><a href="https://www.juev.org/articles.html" rel="nofollow">Список статей</a> :: <a href="https://www.juev.org/recommendations/" rel="nofollow">Рекомендации</a> :: <a href="https://www.juev.org/atom.xml" rel="nofollow">RSS</a></p>
      <p>&copy;&nbsp;<a href="https://denis.evsyukov.org">Denis Evsyukov</a>,&nbsp;2008&ndash;2019&nbsp;Contact me via <script type="text/javascript">document.write("<n uers=\"znvygb:qravf\100riflhxbi\056bet\">Rznvy</n>".replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<="Z"?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26);}));</script>,&nbsp;
      <a href="https://twitter.com/#!/Juev" rel="nofollow">twitter</a> or&nbsp;
      <a href="https://github.com/Juev" rel="nofollow">github</a></p>
    </div>
  </div>
  <script async src="https://static.juev.org/assets/js/master.a08e4d4f.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-26480484-5', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
