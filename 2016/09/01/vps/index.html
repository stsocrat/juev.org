<!DOCTYPE html>
<!--
    You can email me with PGP-key: 0xE8ADA1A55B3CA4EA
-->
<html lang="ru">
<head>
  <link rel="dns-prefetch" href="https://static.juev.org">
  <meta charset="utf-8">
  <title>Миграция сайта с CloudFront на DigitalOcean</title>
  <meta name="description" content="Не так давно полностью перенес свой сайт на CloudFront, отказавшись от сторонних серверов.  И сайт стал быстро работать и платил за это копейки.  Но при очередной попытке поэкспериментировать со св...">
  <meta name="yandex-verification" content="59bb4b98872e096b" />
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- end -->
  <link rel="canonical" href="https://www.juev.org/2016/09/01/vps/">
  <link rel="shortcut icon" href="https://static.juev.org/favicon.ico">
  <link rel="apple-touch-icon" href="https://www.juev.org/apple-touch-icon.png">
  <link rel="alternate" type="application/atom+xml" title="ATOM Feed" href="https://www.juev.org/atom.xml">
  <link rel="stylesheet" type="text/css" href="https://static.juev.org/assets/css/master.6bbfa8b61.css">
  <link rel="prev" href="https://www.juev.org/2016/05/04/nosound/">
  <link rel="next" href="https://www.juev.org/2016/09/03/travis-deploy-over-ssh/">
  <!-- og:meta -->
  <meta content="Миграция сайта с CloudFront на DigitalOcean" property="og:title">
  <meta content="Не так давно полностью перенес свой сайт на CloudFront, отказавшись от сторонних серверов.  И сайт стал быстро работать и платил за это копейки.  Но при очередной попытке поэкспериментировать со св..." property="og:description">
  <meta content="https://www.juev.org/2016/09/01/vps/" property="og:url">
  <meta content="2016-09-01T13:08:00+03:00" property="article:published_time">
  <meta content="vps" property="article:tag">
  <meta content="services" property="article:tag">
  <meta content="cloudfront" property="article:tag">
  <meta content="https://static.juev.org/images/calvin.png" property="og:image">
  <meta content="https://denis.evsyukov.org" property="article:author">
  <!-- end og:meta  -->
  <!-- twitter card -->
  <meta content="summary_large_image" name="twitter:card">
  <meta content="Миграция сайта с CloudFront на DigitalOcean" name="twitter:title">
  <meta content="Не так давно полностью перенес свой сайт на CloudFront, отказавшись от сторонних серверов.  И сайт стал быстро работать и платил за это копейки.  Но при очередной попытке поэкспериментировать со св..." property="twitter:description">
  <meta content="https://www.juev.org/2016/09/01/vps/" name="twitter:url">
  <meta content="https://static.juev.org/images/calvin.png" property="twitter:image:src">
  <!-- end twitter card -->
</head>
<body class="wide">
  <div class="navigation">
    <div class="width-fix">
        <a href="https://www.juev.org/" id="home" rel="nofollow"></a>
      <ul>
        <li><a href="https://www.juev.org/articles.html" rel="nofollow">Статьи</a></li>
        <li>|</li>
        <li><a href="https://denis.evsyukov.org">Об авторе</a></li>
      </ul>
    </div>
  </div>
  <div class="primary-content width-fix">
    <div class="entry"><h1 class="title">Миграция сайта с CloudFront на DigitalOcean</h1>
<div id="metainfo">
<span class="date">01 September 2016</span>
<span class="tags"><a href="https://www.juev.org/tags/#vps" title="View posts tagged with &quot;vps&quot;" rel="nofollow">#vps</a><a href="https://www.juev.org/tags/#services" title="View posts tagged with &quot;services&quot;" rel="nofollow">#services</a><a href="https://www.juev.org/tags/#cloudfront" title="View posts tagged with &quot;cloudfront&quot;" rel="nofollow">#cloudfront</a></span>
</div>
<div class="post"><p>Не так давно полностью перенес свой сайт на CloudFront, отказавшись от сторонних серверов. И сайт стал быстро работать и платил за это копейки. Но при очередной попытке поэкспериментировать со своим сайтом, неожиданно для себя получил счет от Амазона почти на $10. В результате разбирательств, выяснил, что причиной всему является инвалидация страниц после их обновления (<a href="https://aws.amazon.com/ru/cloudfront/pricing/">источник</a>):</p>

<blockquote>
  <p>За первые 1000 путей в месяц, для которых запрашивается аннулирование, дополнительная плата не взимается. За каждый следующий путь, который нужно аннулировать, взимается 0,005 USD.</p>
</blockquote>

<p>Так как у меня на сайте более 300 страниц, то, к примеру, при обновлении шаблона страниц сайта, потребуется провести полное обновление. То есть уже 300 запросов. Три подобных запроса бесплатно, за все остальное будет взиматься дополнительная плата.</p>

<p>После того, как выяснил данный факт, довольно долго ничего не делал с сайтом. И времени на него просто не было. И очень озадачивало то, что теперь при каждом изменении приходиться рассчитывать количество страниц, которое будет затронуто этим изменением. И вот настал тот день, когда мне это надоело.</p>

<p>Стало понятно, что использовать CloudFront в качестве хостинга для обновляемого ресурса не имеет ровными счетом никакого смысла. CloudFront оптимален для статичных ресурсов, таких как стили, изображения, скрипты. И после того, как понял данный факт, задумался о том, куда мигрировать? Думал недолго, так как давно уже являюсь клиентом <a href="https://www.digitalocean.com/?refcode=c5cb9e6574a7" title="DigitalOcean">DigitalOcean</a>, который меня всем устраивал и продолжает устраивать.</p>

<p>Менее чем за минуту создал новую машинку в Лондоне. Сразу включил поддержку IPv6. После чего довольно долго разбирался, как настроить Travis CI для публикации изменений на свой собственный сервер, но разобрался, сейчас на объяснении не буду останавливаться, это тема отдельной статьи. Тут же провел целый ряд изменений на сайте, например, шрифты теперь подгружаются из кастомного CSS-файла, что снизило число запросов и ускорило загрузку.</p>

<p>И только сегодня завершил операцию полной миграции. Пришлось генерировать новый сертификат для сайта. На этот раз воспользовался услугами LetsEncrypt, и  удивлением узнал, что их сертификаты выдаются всего на 3 месяца.</p>

<p>Сайт работает, ограничений на количество обновлений больше нет. И можно снова проводить эксперименты.</p>
</div>
<div class="meta"><div class="pagination">
 <p class="previous">Previous post: <a rel="prev" href="https://www.juev.org/2016/05/04/nosound/" title="View OSX: Отключение звука при старте системы">OSX: Отключение звука при старте системы</a></p>
 <p class="next">Next post: <a rel="next" href="https://www.juev.org/2016/09/03/travis-deploy-over-ssh/" title="View Travis: Deploy over SSH">Travis: Deploy over SSH</a></p></div>
</div>
</div>
  </div><!-- noindex -->
  <div class="footer">
    <div class="width-fix">
      <p><a href="https://www.juev.org/articles.html" rel="nofollow">Список статей</a> :: <a href="https://www.juev.org/recommendations/" rel="nofollow">Рекомендации</a> :: <a href="https://www.juev.org/atom.xml" rel="nofollow">RSS</a></p>
      <p>&copy;&nbsp;<a href="https://denis.evsyukov.org">Denis Evsyukov</a>,&nbsp;2008&ndash;2019&nbsp;Contact me via <script type="text/javascript">document.write("<n uers=\"znvygb:qravf\100riflhxbi\056bet\">Rznvy</n>".replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<="Z"?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26);}));</script>,&nbsp;
      <a href="https://twitter.com/#!/Juev" rel="nofollow">twitter</a> or&nbsp;
      <a href="https://github.com/Juev" rel="nofollow">github</a></p>
    </div>
  </div>
  <script async src="https://static.juev.org/assets/js/master.a08e4d4f.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-26480484-5', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
